!function e(t,n,s){function r(o,a){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return r(n?n:e)},l,l.exports,e,t,n,s)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<s.length;o++)r(s[o]);return r}({1:[function(e,t){function n(e){this.service=e}function s(e){var t={application_id:i.creds.appId,auth_key:i.creds.authKey,nonce:o.randomNonce(),timestamp:o.unixTime()};return e.login&&e.password?t.user={login:e.login,password:e.password}:e.email&&e.password?t.user={email:e.email,password:e.password}:e.provider&&(t.provider=e.provider,e.scope&&(t.scope=e.scope),e.keys&&e.keys.token&&(t.keys={token:e.keys.token}),e.keys&&e.keys.secret&&(messages.keys.secret=e.keys.secret)),t}function r(e,t){var n=Object.keys(e).map(function(t){return"object"==typeof e[t]?Object.keys(e[t]).map(function(n){return t+"["+n+"]="+e[t][n]}).sort().join("&"):t+"="+e[t]}).sort().join("&");return a(n,t).toString()}t.exports=n;var i=e("../qbConfig"),o=e("../qbUtils"),a=e("crypto-js/hmac-sha1");n.prototype.createSession=function(e,t){var n,a=this;"function"==typeof e&&"undefined"==typeof t&&(t=e,e={}),n=s(e),n.signature=r(n,i.creds.authSecret),i.debug&&console.log("AuthProxy.createSession",n),this.service.ajax({url:o.getUrl(i.urls.session),type:"POST",data:n},function(e,n){e?t(e,null):(a.service.setSession(n.session),t(null,n.session))})},n.prototype.destroySession=function(e){var t=this;i.debug&&console.log("AuthProxy.destroySession"),this.service.ajax({url:o.getUrl(i.urls.session),type:"DELETE",dataType:"text"},function(n,s){n?e(n,null):(t.service.setSession(null),e(null,s))})},n.prototype.login=function(e,t){i.debug&&console.log("AuthProxy.login",e),this.service.ajax({url:o.getUrl(i.urls.login),type:"POST",data:e},function(e,n){e?t(e,null):t(null,n.user)})},n.prototype.logout=function(e){i.debug&&console.log("AuthProxy.logout"),this.service.ajax({url:o.getUrl(i.urls.login),type:"DELETE",dataType:"text"},e)}},{"../qbConfig":8,"../qbUtils":10,"crypto-js/hmac-sha1":14}],2:[function(e,t){function n(e){var t=this;this.service=e,h&&(this.roster=new s(e),this.muc=new r(e)),this.dialog=new i(e),this.message=new o(e),this.helpers=new a,this._onMessage=function(e){var n,s,r,i,o,a=e.getAttribute("from"),u=e.getAttribute("type"),c=e.querySelector("body"),l=e.querySelector("invite"),h=e.querySelector("extraParams"),d="groupchat"===u&&e.querySelector("delay"),p="groupchat"===u?t.helpers.getIdFromResource(a):t.helpers.getIdFromNode(a);if(l)return!0;if(h){s={},r=[];for(var f=0,g=h.children.length;g>f;f++)if("attachment"===h.children[f].tagName){i={},o=h.children[f].attributes;for(var m=0,_=o.length;_>m;m++)i[o[m].name]="id"===o[m].name||"size"===o[m].name?parseInt(o[m].value):o[m].value;r.push(i)}else s[h.children[f].tagName]=h.children[f].textContent;r.length>0&&(s.attachments=r)}return n={type:u,body:c&&c.textContent||null,extension:s||null},"function"!=typeof t.onMessageListener||d||t.onMessageListener(p,n),!0},this._onPresence=function(e){var n=e.getAttribute("from"),s=e.getAttribute("type"),r=t.helpers.getIdFromNode(n);if(s)switch(s){case"subscribe":_[r]?t.roster._sendSubscriptionPresence({jid:n,type:"subscribed"}):"function"==typeof t.onSubscribeListener&&t.onSubscribeListener(r);break;case"subscribed":"function"==typeof t.onConfirmSubscribeListener&&t.onConfirmSubscribeListener(r);break;case"unsubscribed":delete _[r],"function"==typeof t.onRejectSubscribeListener&&t.onRejectSubscribeListener(r);break;case"unsubscribe":delete _[r],"function"==typeof t.onRejectSubscribeListener&&t.onRejectSubscribeListener(r);break;case"unavailable":"function"==typeof t.onContactListListener&&_[r]&&t.onContactListListener(r,s)}else"function"==typeof t.onContactListListener&&_[r]&&t.onContactListListener(r,s);return!0},this._onIQ=function(){return!0}}function s(e){this.service=e,this.helpers=new a}function r(e){this.service=e,this.helpers=new a}function i(e){this.service=e,this.helpers=new a}function o(e){this.service=e,this.helpers=new a}function a(){}function u(e){console.log("[QBChat]:",e)}function c(e,t){var n={code:e,status:"error",message:401===e?"Unauthorized":"Unprocessable Entity",detail:t};return u(t),n}function l(){return(new Date).toTimeString().split(" ")[0]}var h="undefined"!=typeof window,d="This function isn't supported outside of the browser (...yet)";h&&e("../../lib/strophe/strophe.min");var p=e("../qbConfig"),f=e("../qbUtils");t.exports=n;var g=p.urls.chat+"/Dialog",m=p.urls.chat+"/Message",_={};if(h){var y=1===p.chatProtocol.active?p.chatProtocol.bosh:p.chatProtocol.websocket,b=new Strophe.Connection(y);p.debug&&(1===p.chatProtocol.active?(b.xmlInput=function(e){"undefined"!=typeof e.children&&e.children[0]&&console.log("[QBChat RECV]:",e.children[0])},b.xmlOutput=function(e){"undefined"!=typeof e.children&&e.children[0]&&console.log("[QBChat SENT]:",e.children[0])}):(b.xmlInput=function(e){console.log("[QBChat RECV]:",e)},b.xmlOutput=function(e){console.log("[QBChat SENT]:",e)}))}n.prototype._autoSendPresence=function(){if(!h)throw d;return b.send($pres().tree()),!0},n.prototype.connect=function(e,t){if(!h)throw d;p.debug&&console.log("ChatProxy.connect",e);var n,s=this;b.connect(e.jid,e.password,function(e){switch(e){case Strophe.Status.ERROR:n=c(422,"Status.ERROR - An error has occurred"),t(n,null);break;case Strophe.Status.CONNECTING:u("Status.CONNECTING"),u("Chat Protocol - "+(1===p.chatProtocol.active?"BOSH":"WebSocket"));break;case Strophe.Status.CONNFAIL:n=c(422,"Status.CONNFAIL - The connection attempt failed"),t(n,null);break;case Strophe.Status.AUTHENTICATING:u("Status.AUTHENTICATING");break;case Strophe.Status.AUTHFAIL:n=c(401,"Status.AUTHFAIL - The authentication attempt failed"),t(n,null);break;case Strophe.Status.CONNECTED:u("Status.CONNECTED at "+l()),b.addHandler(s._onMessage,null,"message"),b.addHandler(s._onPresence,null,"presence"),b.addHandler(s._onIQ,null,"iq"),s.roster.get(function(e){b.send($pres().tree()),b.addTimedHandler(55e3,s._autoSendPresence),t(null,e)});break;case Strophe.Status.DISCONNECTING:u("Status.DISCONNECTING");break;case Strophe.Status.DISCONNECTED:u("Status.DISCONNECTED at "+l()),"function"==typeof s.onDisconnectingListener&&s.onDisconnectingListener(),b.reset();break;case Strophe.Status.ATTACHED:u("Status.ATTACHED")}})},n.prototype.send=function(e,t){if(!h)throw d;var n=$msg({from:b.jid,to:e,type:t.type,id:t.id||b.getUniqueId()});t.body&&n.c("body",{xmlns:Strophe.NS.CLIENT}).t(t.body).up(),t.extension&&(n.c("extraParams",{xmlns:Strophe.NS.CLIENT}),Object.keys(t.extension).forEach(function(e){"attachments"===e?t.extension[e].forEach(function(e){n.c("attachment",e).up()}):n.c(e).t(t.extension[e]).up()})),b.send(n)},n.prototype.sendPres=function(e){if(!h)throw d;b.send($pres({from:b.jid,type:e}))},n.prototype.disconnect=function(){if(!h)throw d;b.flush(),b.disconnect()},n.prototype.addListener=function(e,t){function n(){return t(),e.live!==!1}if(!h)throw d;return b.addHandler(n,null,e.name||null,e.type||null,e.id||null,e.from||null)},n.prototype.deleteListener=function(e){if(!h)throw d;b.deleteHandler(e)},s.prototype.get=function(e){var t,n,s,r=this,i={};t=$iq({from:b.jid,type:"get",id:b.getUniqueId("roster")}).c("query",{xmlns:Strophe.NS.ROSTER}),b.sendIQ(t,function(t){n=t.getElementsByTagName("item");for(var o=0,a=n.length;a>o;o++)s=r.helpers.getIdFromNode(n[o].getAttribute("jid")).toString(),i[s]={subscription:n[o].getAttribute("subscription"),ask:n[o].getAttribute("ask")||null},(n[o].getAttribute("ask")||"none"!==n[o].getAttribute("subscription"))&&(_[s]=!0);e(i)})},s.prototype.add=function(e){this._sendRosterRequest({jid:e,type:"subscribe"})},s.prototype.confirm=function(e){this._sendRosterRequest({jid:e,type:"subscribed"})},s.prototype.reject=function(e){this._sendRosterRequest({jid:e,type:"unsubscribed"})},s.prototype.remove=function(e){this._sendSubscriptionPresence({jid:e,type:"unsubscribe"}),this._sendSubscriptionPresence({jid:e,type:"unsubscribed"}),this._sendRosterRequest({jid:e,subscription:"remove",type:"unsubscribe"})},s.prototype._sendRosterRequest=function(e){var t,n,s={},r=this;t=$iq({from:b.jid,type:"set",id:b.getUniqueId("roster")}).c("query",{xmlns:Strophe.NS.ROSTER}),e.jid&&(s.jid=e.jid),e.subscription&&(s.subscription=e.subscription),t.c("item",s),n=r.helpers.getIdFromNode(e.jid).toString(),b.sendIQ(t,function(){switch(e.type){case"subscribe":r._sendSubscriptionPresence(e),_[n]=!0;break;case"subscribed":r._sendSubscriptionPresence(e),_[n]=!0,e.type="subscribe",r._sendSubscriptionPresence(e);break;case"unsubscribed":r._sendSubscriptionPresence(e);break;case"unsubscribe":delete _[n],e.type="unavailable",r._sendSubscriptionPresence(e)}})},s.prototype._sendSubscriptionPresence=function(e){var t;t=$pres({to:e.jid,type:e.type}),b.send(t)},r.prototype.join=function(e,t){var n,s=this,r=b.getUniqueId("join");n=$pres({from:b.jid,to:s.helpers.getRoomJid(e),id:r}).c("x",{xmlns:Strophe.NS.MUC}),b.addHandler(t,null,"presence",null,r),b.send(n)},r.prototype.leave=function(e,t){var n,s=this,r=s.helpers.getRoomJid(e);n=$pres({from:b.jid,to:r,type:"unavailable"}),b.addHandler(t,null,"presence","unavailable",null,r),b.send(n)},i.prototype.list=function(e,t){"function"==typeof e&&"undefined"==typeof t&&(t=e,e={}),p.debug&&console.log("DialogProxy.list",e),this.service.ajax({url:f.getUrl(g),data:e},t)},i.prototype.create=function(e,t){p.debug&&console.log("DialogProxy.create",e),this.service.ajax({url:f.getUrl(g),type:"POST",data:e},t)},i.prototype.update=function(e,t,n){p.debug&&console.log("DialogProxy.update",e,t),this.service.ajax({url:f.getUrl(g,e),type:"PUT",data:t},n)},i.prototype.delete=function(e,t){p.debug&&console.log("DialogProxy.delete",e),this.service.ajax({url:f.getUrl(g,e),type:"DELETE",dataType:"text"},t)},o.prototype.list=function(e,t){p.debug&&console.log("MessageProxy.list",e),this.service.ajax({url:f.getUrl(m),data:e},t)},o.prototype.update=function(e,t,n){p.debug&&console.log("MessageProxy.update",e,t),this.service.ajax({url:f.getUrl(m,e),type:"PUT",data:t},n)},o.prototype.delete=function(e,t){p.debug&&console.log("MessageProxy.delete",e),this.service.ajax({url:f.getUrl(m,e),type:"DELETE",dataType:"text"},t)},a.prototype={getUserJid:function(e,t){return e+"-"+t+"@"+p.endpoints.chat},getIdFromNode:function(e){return parseInt(Strophe.getNodeFromJid(e).split("-")[0])},getRoomJid:function(e){return e+"/"+this.getIdFromNode(b.jid)},getIdFromResource:function(e){return parseInt(Strophe.getResourceFromJid(e))},getUniqueId:function(e){return b.getUniqueId(e)}}},{"../../lib/strophe/strophe.min":12,"../qbConfig":8,"../qbUtils":10}],3:[function(e,t){function n(e){this.service=e}function s(e){for(var t=s.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;i--;)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,s){n&&(r[t.q.name][n]=s)}),r}t.exports=n;var r=e("../qbConfig"),i=e("../qbUtils"),o=r.urls.blobs+"/tagged";n.prototype.create=function(e,t){r.debug&&console.log("ContentProxy.create",e),this.service.ajax({url:i.getUrl(r.urls.blobs),data:{blob:e},type:"POST"},function(e,n){e?t(e,null):t(e,n.blob)})},n.prototype.list=function(e,t){"function"==typeof e&&"undefined"==typeof t&&(t=e,e=null),this.service.ajax({url:i.getUrl(r.urls.blobs)},function(e,n){e?t(e,null):t(e,n)})},n.prototype.delete=function(e,t){this.service.ajax({url:i.getUrl(r.urls.blobs,e),type:"DELETE",dataType:"text"},function(e){e?t(e,null):t(null,!0)})},n.prototype.createAndUpload=function(e,t){var n,i,o,a,u,c={},l=this;r.debug&&console.log("ContentProxy.createAndUpload",e),n=e.file,i=e.name||n.name,o=e.type||n.type,a=n.size,c.name=i,c.content_type=o,e.public&&(c.public=e.public),e.tag_list&&(c.tag_list=e.tag_list),this.create(c,function(e,r){if(e)t(e,null);else{var i=s(r.blob_object_access.params),o={url:i.protocol+"://"+i.host},c=new FormData;u=r.id,Object.keys(i.queryKey).forEach(function(e){c.append(e,decodeURIComponent(i.queryKey[e]))}),c.append("file",n,r.name),o.data=c,l.upload(o,function(e,n){e?t(e,null):(r.path=n.Location,l.markUploaded({id:u,size:a},function(e){e?t(e,null):t(null,r)}))})}})},n.prototype.upload=function(e,t){this.service.ajax({url:e.url,data:e.data,dataType:"xml",contentType:!1,processData:!1,type:"POST"},function(e,n){if(e)t(e,null);else{var s,i,o={},a=n.documentElement,u=a.childNodes;for(s=0,i=u.length;i>s;s++)o[u[s].nodeName]=u[s].childNodes[0].nodeValue;r.debug&&console.log("result",o),t(null,o)}})},n.prototype.taggedForCurrentUser=function(e){this.service.ajax({url:i.getUrl(o)},function(t,n){t?e(t,null):e(null,n)})},n.prototype.markUploaded=function(e,t){this.service.ajax({url:i.getUrl(r.urls.blobs,e.id+"/complete"),type:"PUT",data:{size:e.size},dataType:"text"},function(e,n){e?t(e,null):t(null,n)})},n.prototype.getInfo=function(e,t){this.service.ajax({url:i.getUrl(r.urls.blobs,e)},function(e,n){e?t(e,null):t(null,n)})},n.prototype.getFile=function(e,t){this.service.ajax({url:i.getUrl(r.urls.blobs,e)},function(e,n){e?t(e,null):t(null,n)})},n.prototype.getFileUrl=function(e,t){this.service.ajax({url:i.getUrl(r.urls.blobs,e+"/getblobobjectbyid"),type:"POST"},function(e,n){e?t(e,null):t(null,n.blob_object_access.params)})},n.prototype.update=function(e,t){var n={};n.blob={},"undefined"!=typeof e.name&&(n.blob.name=e.name),this.service.ajax({url:i.getUrl(r.urls.blobs,e.id),data:n},function(e,n){e?t(e,null):t(null,n)})},s.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},{"../qbConfig":8,"../qbUtils":10}],4:[function(e,t){function n(e){this.service=e,s.debug&&console.log("LocationProxy",e)}t.exports=n;var s=e("../qbConfig"),r=e("../qbUtils");n.prototype.create=function(e,t,n){s.debug&&console.log("DataProxy.create",e,t),this.service.ajax({url:r.getUrl(s.urls.data,e),data:t,type:"POST"},function(e,t){e?n(e,null):n(e,t)})},n.prototype.list=function(e,t,n){"undefined"==typeof n&&"function"==typeof t&&(n=t,t=null),s.debug&&console.log("DataProxy.list",e,t),this.service.ajax({url:r.getUrl(s.urls.data,e),data:t},function(e,t){e?n(e,null):n(e,t)})},n.prototype.update=function(e,t,n){s.debug&&console.log("DataProxy.update",e,t),this.service.ajax({url:r.getUrl(s.urls.data,e+"/"+t._id),data:t,type:"PUT"},function(e,t){e?n(e,null):n(e,t)})},n.prototype.delete=function(e,t,n){s.debug&&console.log("DataProxy.delete",e,t),this.service.ajax({url:r.getUrl(s.urls.data,e+"/"+t),type:"DELETE",dataType:"text"},function(e){e?n(e,null):n(e,!0)})},n.prototype.uploadFile=function(e,t,n){var i;s.debug&&console.log("DataProxy.uploadFile",e,t),i=new FormData,i.append("field_name",t.field_name),i.append("file",t.file),this.service.ajax({url:r.getUrl(s.urls.data,e+"/"+t.id+"/file"),data:i,contentType:!1,processData:!1,type:"POST"},function(e,t){e?n(e,null):n(e,t)})},n.prototype.updateFile=function(e,t,n){var i;s.debug&&console.log("DataProxy.updateFile",e,t),i=new FormData,i.append("field_name",t.field_name),i.append("file",t.file),this.service.ajax({url:r.getUrl(s.urls.data,e+"/"+t.id+"/file"),data:i,contentType:!1,processData:!1,type:"POST"},function(e,t){e?n(e,null):n(e,t)})},n.prototype.downloadFile=function(e,t,n){s.debug&&console.log("DataProxy.downloadFile",e,t);var i=r.getUrl(s.urls.data,e+"/"+t.id+"/file");i+="?field_name="+t.field_name+"&token="+this.service.getSession().token,n(null,i)},n.prototype.deleteFile=function(e,t,n){s.debug&&console.log("DataProxy.deleteFile",e,t),this.service.ajax({url:r.getUrl(s.urls.data,e+"/"+t.id+"/file"),data:{field_name:t.field_name},dataType:"text",type:"DELETE"},function(e){e?n(e,null):n(e,!0)})}},{"../qbConfig":8,"../qbUtils":10}],5:[function(e,t){function n(e){this.service=e,this.geodata=new s(e),this.places=new r(e),i.debug&&console.log("LocationProxy",e)}function s(e){this.service=e}function r(e){this.service=e}t.exports=n;var i=e("../qbConfig"),o=e("../qbUtils"),a=i.urls.geodata+"/find";s.prototype.create=function(e,t){i.debug&&console.log("GeoProxy.create",{geo_data:e}),this.service.ajax({url:o.getUrl(i.urls.geodata),data:{geo_data:e},type:"POST"},function(e,n){e?t(e,null):t(e,n.geo_datum)})},s.prototype.update=function(e,t){var n,s=["longitude","latitude","status"],r={};for(n in e)e.hasOwnProperty(n)&&s.indexOf(n)>0&&(r[n]=e[n]);i.debug&&console.log("GeoProxy.create",e),this.service.ajax({url:o.getUrl(i.urls.geodata,e.id),data:{geo_data:r},type:"PUT"},function(e,n){e?t(e,null):t(e,n.geo_datum)})},s.prototype.get=function(e,t){i.debug&&console.log("GeoProxy.get",e),this.service.ajax({url:o.getUrl(i.urls.geodata,e)},function(e,n){e?t(e,null):t(null,n.geo_datum)})},s.prototype.list=function(e,t){"function"==typeof e&&(t=e,e=void 0),i.debug&&console.log("GeoProxy.find",e),this.service.ajax({url:o.getUrl(a),data:e},t)},s.prototype.delete=function(e,t){i.debug&&console.log("GeoProxy.delete",e),this.service.ajax({url:o.getUrl(i.urls.geodata,e),type:"DELETE",dataType:"text"},function(e){e?t(e,null):t(null,!0)})},s.prototype.purge=function(e,t){i.debug&&console.log("GeoProxy.purge",e),this.service.ajax({url:o.getUrl(i.urls.geodata),data:{days:e},type:"DELETE",dataType:"text"},function(e){e?t(e,null):t(null,!0)})},r.prototype.list=function(e,t){i.debug&&console.log("PlacesProxy.list",e),this.service.ajax({url:o.getUrl(i.urls.places)},t)},r.prototype.create=function(e,t){i.debug&&console.log("PlacesProxy.create",e),this.service.ajax({url:o.getUrl(i.urls.places),data:{place:e},type:"POST"},t)},r.prototype.get=function(e,t){i.debug&&console.log("PlacesProxy.get",e),this.service.ajax({url:o.getUrl(i.urls.places,e)},t)},r.prototype.update=function(e,t){i.debug&&console.log("PlacesProxy.update",e),this.service.ajax({url:o.getUrl(i.urls.places,e.id),data:{place:e},type:"PUT"},t)},r.prototype.delete=function(e,t){i.debug&&console.log("PlacesProxy.delete",e),this.service.ajax({url:o.getUrl(i.urls.places,e),type:"DELETE",dataType:"text"},t)}},{"../qbConfig":8,"../qbUtils":10}],6:[function(e,t){function n(e){this.service=e,this.tokens=new s(e),this.subscriptions=new r(e),this.events=new i(e)}function s(e){this.service=e}function r(e){this.service=e}function i(e){this.service=e}t.exports=n;var o=e("../qbConfig"),a=e("../qbUtils");s.prototype.create=function(e,t){var n={push_token:{environment:e.environment,client_identification_sequence:e.client_identification_sequence},device:{platform:e.platform,udid:e.udid}};o.debug&&console.log("TokensProxy.create",n),this.service.ajax({url:a.getUrl(o.urls.pushtokens),type:"POST",data:n},function(e,n){e?t(e,null):t(null,n.push_token)})},s.prototype.delete=function(e,t){o.debug&&console.log("MessageProxy.deletePushToken",e),this.service.ajax({url:a.getUrl(o.urls.pushtokens,e),type:"DELETE",dataType:"text"},function(e){e?t(e,null):t(null,!0)})},r.prototype.create=function(e,t){o.debug&&console.log("MessageProxy.createSubscription",e),this.service.ajax({url:a.getUrl(o.urls.subscriptions),type:"POST",data:e},t)},r.prototype.list=function(e){o.debug&&console.log("MessageProxy.listSubscription"),this.service.ajax({url:a.getUrl(o.urls.subscriptions)},e)},r.prototype.delete=function(e,t){o.debug&&console.log("MessageProxy.deleteSubscription",e),this.service.ajax({url:a.getUrl(o.urls.subscriptions,e),type:"DELETE",dataType:"text"},function(e){e?t(e,null):t(null,!0)})},i.prototype.create=function(e,t){o.debug&&console.log("MessageProxy.createEvent",e);var n={event:e};this.service.ajax({url:a.getUrl(o.urls.events),type:"POST",data:n},t)},i.prototype.list=function(e){o.debug&&console.log("MessageProxy.listEvents"),this.service.ajax({url:a.getUrl(o.urls.events)},e)},i.prototype.get=function(e,t){o.debug&&console.log("MessageProxy.getEvents",e),this.service.ajax({url:a.getUrl(o.urls.events,e)},t)},i.prototype.update=function(e,t){o.debug&&console.log("MessageProxy.createEvent",e);var n={event:e};this.service.ajax({url:a.getUrl(o.urls.events,e.id),type:"PUT",data:n},t)},i.prototype.delete=function(e,t){o.debug&&console.log("MessageProxy.deleteEvent",e),this.service.ajax({url:a.getUrl(o.urls.events,e),type:"DELETE"},t)}},{"../qbConfig":8,"../qbUtils":10}],7:[function(e,t){function n(e){this.service=e}function s(e){var t=e.field in a?"date":typeof e.value;return e.value instanceof Array&&("object"==t&&(t=typeof e.value[0]),e.value=e.value.toString()),[t,e.field,e.param,e.value].join(" ")}function r(e){var t=e.field in a?"date":e.field in u?"number":"string";return[e.sort,t,e.field].join(" ")}t.exports=n;var i=e("../qbConfig"),o=e("../qbUtils"),a=["created_at","updated_at","last_request_at"],u=["id","external_user_id"],c=i.urls.users+"/password/reset";n.prototype.listUsers=function(e,t){var n,a={},u=[];"function"==typeof e&&"undefined"==typeof t&&(t=e,e={}),e.filter&&(e.filter instanceof Array?e.filter.forEach(function(e){n=s(e),u.push(n)}):(n=s(e.filter),u.push(n)),a.filter=u),e.order&&(a.order=r(e.order)),e.page&&(a.page=e.page),e.per_page&&(a.per_page=e.per_page),i.debug&&console.log("UsersProxy.listUsers",a),this.service.ajax({url:o.getUrl(i.urls.users),data:a},t)},n.prototype.get=function(e,t){var n;"number"==typeof e?(n=e,e={}):e.login?n="by_login":e.full_name?n="by_full_name":e.facebook_id?n="by_facebook_id":e.twitter_id?n="by_twitter_id":e.email?n="by_email":e.tags?n="by_tags":e.external&&(n="external/"+e.external,e={}),i.debug&&console.log("UsersProxy.get",e),this.service.ajax({url:o.getUrl(i.urls.users,n),data:e},function(e,n){e?t(e,null):t(null,n.user||n)})},n.prototype.create=function(e,t){i.debug&&console.log("UsersProxy.create",e),this.service.ajax({url:o.getUrl(i.urls.users),type:"POST",data:{user:e}},function(e,n){e?t(e,null):t(null,n.user)})},n.prototype.update=function(e,t,n){i.debug&&console.log("UsersProxy.update",e,t),this.service.ajax({url:o.getUrl(i.urls.users,e),type:"PUT",data:{user:t}},function(e,t){e?n(e,null):n(null,t.user)})},n.prototype.delete=function(e,t){var n;"number"==typeof e?n=e:e.external&&(n="external/"+e.external),i.debug&&console.log("UsersProxy.delete",n),this.service.ajax({url:o.getUrl(i.urls.users,n),type:"DELETE",dataType:"text"},t)},n.prototype.resetPassword=function(e,t){i.debug&&console.log("UsersProxy.resetPassword",e),this.service.ajax({url:o.getUrl(c),data:{email:e}},t)}},{"../qbConfig":8,"../qbUtils":10}],8:[function(e,t){var n={version:"1.3.1",creds:{appId:"",authKey:"",authSecret:""},endpoints:{api:"api.quickblox.com",chat:"chat.quickblox.com",muc:"muc.chat.quickblox.com",turn:"turnserver.quickblox.com",s3Bucket:"qbprod"},chatProtocol:{bosh:"https://chat.quickblox.com:8081",websocket:"ws://chat.quickblox.com:5290",active:1},urls:{session:"session",login:"login",users:"users",chat:"chat",blobs:"blobs",geodata:"geodata",places:"places",pushtokens:"push_tokens",subscriptions:"subscriptions",events:"events",data:"data",type:".json"},ssl:!0,timeout:null,debug:!1};n.set=function(e){Object.keys(e).forEach(function(t){"set"!==t&&n.hasOwnProperty(t)&&("object"!=typeof e[t]?n[t]=e[t]:Object.keys(e[t]).forEach(function(s){n.hasOwnProperty(t)&&(n[t][s]=e[t][s])}))})},t.exports=n},{}],9:[function(e,t){function n(){this.qbInst={config:r,session:null},r.debug&&console.log("ServiceProxy",this.qbInst)}t.exports=n;var s="undefined"!=typeof window&&window.jQuery,r=e("./qbConfig");if(!s)var i=e("request");n.prototype.setSession=function(e){this.qbInst.session=e},n.prototype.getSession=function(){return this.qbInst.session},n.prototype.ajax=function(e,t){r.debug&&console.log("ServiceProxy",e.type||"GET",e);var n=this,o={url:e.url,type:e.type||"GET",dataType:e.dataType||"json",data:e.data||" ",timeout:null!==r.timeout?r.timeout:null,beforeSend:function(e,t){r.debug&&console.log("ServiceProxy.ajax beforeSend",e,t),-1===t.url.indexOf("://"+r.endpoints.s3Bucket)&&(console.log("setting headers on request to "+t.url),n.qbInst.session&&n.qbInst.session.token&&e.setRequestHeader("QB-Token",n.qbInst.session.token))},success:function(e){r.debug&&console.log("ServiceProxy.ajax success",e),t(null,e)},error:function(e,n,s){r.debug&&console.log("ServiceProxy.ajax error",e.status,s,e.responseText);var i={code:e.status,status:n,message:s,detail:e.responseText};t(i,null)}};if(!s){"json"===o.dataType&&(o.json=o.data),-1===e.url.indexOf("://"+r.endpoints.s3Bucket)&&n.qbInst.session&&n.qbInst.session.token&&(o.headers={"QB-Token":n.qbInst.session.token}),o.method=o.type;var a=function(e,n,s){if(e||-1!==s.toString().indexOf("DOCTYPE")){var i={code:n.statusCode,status:n.headers.status,message:s,detail:s.errors};t(i,null)}else r.debug&&console.log("ServiceProxy.ajax success",data),t(null,s)}}("boolean"==typeof e.contentType||"string"==typeof e.contentType)&&(o.contentType=e.contentType),"boolean"==typeof e.processData&&(o.processData=e.processData),s?jQuery.ajax(o):i(o,a)}},{"./qbConfig":8,request:void 0}],10:[function(e,t,n){var s=e("./qbConfig");n.randomNonce=function(){return Math.floor(1e4*Math.random())},n.unixTime=function(){return Math.floor(Date.now()/1e3)},n.getUrl=function(e,t){var n=s.ssl?"https://":"http://",r=t?"/"+t:"";return n+s.endpoints.api+"/"+e+r+s.urls.type}},{"./qbConfig":8}],11:[function(e,t){function n(){}var s=e("./qbConfig"),r=e("./qbProxy"),i=e("./modules/qbAuth"),o=e("./modules/qbUsers"),a=e("./modules/qbChat"),u=e("./modules/qbContent"),c=e("./modules/qbLocation"),l=e("./modules/qbMessages"),h=e("./modules/qbData");"undefined"!=typeof window&&"undefined"==typeof window.QB&&(window.QB=new n),n.prototype.init=function(e,t,n,d){d&&"boolean"==typeof d?s.debug=d:d&&"object"==typeof d&&s.set(d),this.service=new r,this.auth=new i(this.service),this.users=new o(this.service),this.chat=new a(this.service),this.content=new u(this.service),this.location=new c(this.service),this.messages=new l(this.service),this.data=new h(this.service),"string"!=typeof e||t||n?(s.creds.appId=e,s.creds.authKey=t,s.creds.authSecret=n):this.service.setSession({token:e}),console&&s.debug&&console.log("QuickBlox.init",this)},n.prototype.createSession=function(e,t){this.auth.createSession(e,t)},n.prototype.destroySession=function(e){this.auth.destroySession(e)},n.prototype.login=function(e,t){this.auth.login(e,t)},n.prototype.logout=function(e){this.auth.logout(e)},t.exports=new n,t.exports.QuickBlox=n},{"./modules/qbAuth":1,"./modules/qbChat":2,"./modules/qbContent":3,"./modules/qbData":4,"./modules/qbLocation":5,"./modules/qbMessages":6,"./modules/qbUsers":7,"./qbConfig":8,"./qbProxy":9}],12:[function(e,t){t.exports=function(){function e(e){return l(s(c(e),8*e.length))}function t(e,t){return h(o(e,t))}function n(e,t){return l(o(e,t))}function s(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n,s,o,c,l,h,d,p,f=new Array(80),g=1732584193,m=-271733879,_=-1732584194,y=271733878,b=-1009589776;for(n=0;n<e.length;n+=16){for(c=g,l=m,h=_,d=y,p=b,s=0;80>s;s++)f[s]=16>s?e[n+s]:u(f[s-3]^f[s-8]^f[s-14]^f[s-16],1),o=a(a(u(g,5),r(s,m,_,y)),a(a(b,f[s]),i(s))),b=y,y=_,_=u(m,30),m=g,g=o;g=a(g,c),m=a(m,l),_=a(_,h),y=a(y,d),b=a(b,p)}return[g,m,_,y,b]}function r(e,t,n,s){return 20>e?t&n|~t&s:40>e?t^n^s:60>e?t&n|t&s|n&s:t^n^s}function i(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function o(e,t){var n=c(e);n.length>16&&(n=s(n,8*e.length));for(var r=new Array(16),i=new Array(16),o=0;16>o;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var a=s(r.concat(c(t)),512+8*t.length);return s(i.concat(a),672)}function a(e,t){var n=(65535&e)+(65535&t),s=(e>>16)+(t>>16)+(n>>16);return s<<16|65535&n}function u(e,t){return e<<t|e>>>32-t}function c(e){for(var t=[],n=255,s=0;s<8*e.length;s+=8)t[s>>5]|=(e.charCodeAt(s/8)&n)<<24-s%32;return t}function l(e){for(var t="",n=255,s=0;s<32*e.length;s+=8)t+=String.fromCharCode(e[s>>5]>>>24-s%32&n);return t}function h(e){for(var t,n,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;4>n;n++)r+=8*i+6*n>32*e.length?"=":s.charAt(t>>6*(3-n)&63);return r}var d=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t){var n,s,r,i,o,a,u,c="",l=0;do n=t.charCodeAt(l++),s=t.charCodeAt(l++),r=t.charCodeAt(l++),i=n>>2,o=(3&n)<<4|s>>4,a=(15&s)<<2|r>>6,u=63&r,isNaN(s)?a=u=64:isNaN(r)&&(u=64),c=c+e.charAt(i)+e.charAt(o)+e.charAt(a)+e.charAt(u);while(l<t.length);return c},decode:function(t){var n,s,r,i,o,a,u,c="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do i=e.indexOf(t.charAt(l++)),o=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),u=e.indexOf(t.charAt(l++)),n=i<<2|o>>4,s=(15&o)<<4|a>>2,r=(3&a)<<6|u,c+=String.fromCharCode(n),64!=a&&(c+=String.fromCharCode(s)),64!=u&&(c+=String.fromCharCode(r));while(l<t.length);return c}};return t}(),p=function(){var e=function(e,t){var n=(65535&e)+(65535&t),s=(e>>16)+(t>>16)+(n>>16);return s<<16|65535&n},t=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},s=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},r=function(e){for(var t="0123456789abcdef",n="",s=0;s<4*e.length;s++)n+=t.charAt(e[s>>2]>>s%4*8+4&15)+t.charAt(e[s>>2]>>s%4*8&15);return n},i=function(n,s,r,i,o,a){return e(t(e(e(s,n),e(i,a)),o),r)},o=function(e,t,n,s,r,o,a){return i(t&n|~t&s,e,t,r,o,a)},a=function(e,t,n,s,r,o,a){return i(t&s|n&~s,e,t,r,o,a)},u=function(e,t,n,s,r,o,a){return i(t^n^s,e,t,r,o,a)},c=function(e,t,n,s,r,o,a){return i(n^(t|~s),e,t,r,o,a)},l=function(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var s,r,i,l,h=1732584193,d=-271733879,p=-1732584194,f=271733878,g=0;g<t.length;g+=16)s=h,r=d,i=p,l=f,h=o(h,d,p,f,t[g+0],7,-680876936),f=o(f,h,d,p,t[g+1],12,-389564586),p=o(p,f,h,d,t[g+2],17,606105819),d=o(d,p,f,h,t[g+3],22,-1044525330),h=o(h,d,p,f,t[g+4],7,-176418897),f=o(f,h,d,p,t[g+5],12,1200080426),p=o(p,f,h,d,t[g+6],17,-1473231341),d=o(d,p,f,h,t[g+7],22,-45705983),h=o(h,d,p,f,t[g+8],7,1770035416),f=o(f,h,d,p,t[g+9],12,-1958414417),p=o(p,f,h,d,t[g+10],17,-42063),d=o(d,p,f,h,t[g+11],22,-1990404162),h=o(h,d,p,f,t[g+12],7,1804603682),f=o(f,h,d,p,t[g+13],12,-40341101),p=o(p,f,h,d,t[g+14],17,-1502002290),d=o(d,p,f,h,t[g+15],22,1236535329),h=a(h,d,p,f,t[g+1],5,-165796510),f=a(f,h,d,p,t[g+6],9,-1069501632),p=a(p,f,h,d,t[g+11],14,643717713),d=a(d,p,f,h,t[g+0],20,-373897302),h=a(h,d,p,f,t[g+5],5,-701558691),f=a(f,h,d,p,t[g+10],9,38016083),p=a(p,f,h,d,t[g+15],14,-660478335),d=a(d,p,f,h,t[g+4],20,-405537848),h=a(h,d,p,f,t[g+9],5,568446438),f=a(f,h,d,p,t[g+14],9,-1019803690),p=a(p,f,h,d,t[g+3],14,-187363961),d=a(d,p,f,h,t[g+8],20,1163531501),h=a(h,d,p,f,t[g+13],5,-1444681467),f=a(f,h,d,p,t[g+2],9,-51403784),p=a(p,f,h,d,t[g+7],14,1735328473),d=a(d,p,f,h,t[g+12],20,-1926607734),h=u(h,d,p,f,t[g+5],4,-378558),f=u(f,h,d,p,t[g+8],11,-2022574463),p=u(p,f,h,d,t[g+11],16,1839030562),d=u(d,p,f,h,t[g+14],23,-35309556),h=u(h,d,p,f,t[g+1],4,-1530992060),f=u(f,h,d,p,t[g+4],11,1272893353),p=u(p,f,h,d,t[g+7],16,-155497632),d=u(d,p,f,h,t[g+10],23,-1094730640),h=u(h,d,p,f,t[g+13],4,681279174),f=u(f,h,d,p,t[g+0],11,-358537222),p=u(p,f,h,d,t[g+3],16,-722521979),d=u(d,p,f,h,t[g+6],23,76029189),h=u(h,d,p,f,t[g+9],4,-640364487),f=u(f,h,d,p,t[g+12],11,-421815835),p=u(p,f,h,d,t[g+15],16,530742520),d=u(d,p,f,h,t[g+2],23,-995338651),h=c(h,d,p,f,t[g+0],6,-198630844),f=c(f,h,d,p,t[g+7],10,1126891415),p=c(p,f,h,d,t[g+14],15,-1416354905),d=c(d,p,f,h,t[g+5],21,-57434055),h=c(h,d,p,f,t[g+12],6,1700485571),f=c(f,h,d,p,t[g+3],10,-1894986606),p=c(p,f,h,d,t[g+10],15,-1051523),d=c(d,p,f,h,t[g+1],21,-2054922799),h=c(h,d,p,f,t[g+8],6,1873313359),f=c(f,h,d,p,t[g+15],10,-30611744),p=c(p,f,h,d,t[g+6],15,-1560198380),d=c(d,p,f,h,t[g+13],21,1309151649),h=c(h,d,p,f,t[g+4],6,-145523070),f=c(f,h,d,p,t[g+11],10,-1120210379),p=c(p,f,h,d,t[g+2],15,718787259),d=c(d,p,f,h,t[g+9],21,-343485551),h=e(h,s),d=e(d,r),p=e(p,i),f=e(f,l);
return[h,d,p,f]},h={hexdigest:function(e){return r(l(n(e),8*e.length))},hash:function(e){return s(l(n(e),8*e.length))}};return h}();Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,s=Array.prototype.concat,r=n.call(arguments,1);return function(){return t.apply(e?e:this,s.call(r,n.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),function(s){function r(e,t){return new c.Builder(e,t)}function i(e){return new c.Builder("message",e)}function a(e){return new c.Builder("iq",e)}function u(e){return new c.Builder("presence",e)}var c;c={VERSION:"1.1.3",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<c.XHTML.tags.length;t++)if(e==c.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof c.XHTML.attributes[e]&&c.XHTML.attributes[e].length>0)for(var n=0;n<c.XHTML.attributes[e].length;n++)if(t==c.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<c.XHTML.css.length;t++)if(e==c.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){c.NS[e]=t},forEachChild:function(e,t,n){var s,r;for(s=0;s<e.childNodes.length;s++)r=e.childNodes[s],r.nodeType==c.ElementType.NORMAL&&(!t||this.isTagEqual(r,t))&&n(r)},isTagEqual:function(e,t){return e.tagName.toLowerCase()==t.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return c._xmlGenerator||(c._xmlGenerator=c._makeGenerator()),c._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(s){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,s,r=c.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++)if(arguments[t])if("string"==typeof arguments[t]||"number"==typeof arguments[t])r.appendChild(c.xmlTextNode(arguments[t]));else if("object"==typeof arguments[t]&&"function"==typeof arguments[t].sort)for(n=0;n<arguments[t].length;n++)"object"==typeof arguments[t][n]&&"function"==typeof arguments[t][n].sort&&r.setAttribute(arguments[t][n][0],arguments[t][n][1]);else if("object"==typeof arguments[t])for(s in arguments[t])arguments[t].hasOwnProperty(s)&&r.setAttribute(s,arguments[t][s]);return r},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlunescape:function(e){return e=e.replace(/\&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&apos;/g,"'"),e=e.replace(/&quot;/g,'"')},xmlTextNode:function(e){return c.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==c.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType==c.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return c.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType==c.ElementType.NORMAL){for(n=c.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName.toLowerCase(),e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(c.copyElement(e.childNodes[t]))}else e.nodeType==c.ElementType.TEXT&&(n=c.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,s,r,i,o,a,u,l,h,d;if(e.nodeType==c.ElementType.NORMAL)if(r=e.nodeName.toLowerCase(),c.XHTML.validTag(r))try{for(n=c.xmlElement(r),t=0;t<c.XHTML.attributes[r].length;t++)if(i=c.XHTML.attributes[r][t],o=e.getAttribute(i),"undefined"!=typeof o&&null!==o&&""!==o&&o!==!1&&0!==o)if("style"==i&&"object"==typeof o&&"undefined"!=typeof o.cssText&&(o=o.cssText),"style"==i){for(a=[],u=o.split(";"),s=0;s<u.length;s++)l=u[s].split(":"),h=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),c.XHTML.validCSS(h)&&(d=l[1].replace(/^\s*/,"").replace(/\s*$/,""),a.push(h+": "+d));a.length>0&&(o=a.join("; "),n.setAttribute(i,o))}else n.setAttribute(i,o);for(t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]))}catch(p){n=c.xmlTextNode("")}else for(n=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]));else if(e.nodeType==c.ElementType.FRAGMENT)for(n=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]));else e.nodeType==c.ElementType.TEXT&&(n=c.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=c.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},log:function(){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,s,r=e.nodeName;for(e.getAttribute("_realname")&&(r=e.getAttribute("_realname")),t="<"+r,n=0;n<e.attributes.length;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName.toLowerCase()+"='"+e.attributes[n].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch(s=e.childNodes[n],s.nodeType){case c.ElementType.NORMAL:t+=c.serialize(s);break;case c.ElementType.TEXT:t+=c.xmlescape(s.nodeValue);break;case c.ElementType.CDATA:t+="<![CDATA["+s.nodeValue+"]]>"}t+="</"+r+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){c._connectionPlugins[e]=t}},c.Builder=function(e,t){("presence"==e||"message"==e||"iq"==e)&&(t&&!t.xmlns?t.xmlns=c.NS.CLIENT:t||(t={xmlns:c.NS.CLIENT})),this.nodeTree=c.xmlElement(e,t),this.node=this.nodeTree},c.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return c.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t]);return this},c:function(e,t,n){var s=c.xmlElement(e,t,n);return this.node.appendChild(s),n||(this.node=s),this},cnode:function(e){var t,n=c.xmlGenerator();try{t=void 0!==n.importNode}catch(s){t=!1}var r=t?n.importNode(e,!0):c.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=c.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=c.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},c.Handler=function(e,t,n,s,r,i,o){this.handler=e,this.ns=t,this.name=n,this.type=s,this.id=r,this.options=o||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?i?c.getBareJidFromJid(i):null:i,this.user=!0},c.Handler.prototype={isMatch:function(e){var t,n=null;if(n=this.options.matchBare?c.getBareJidFromJid(e.getAttribute("from")):e.getAttribute("from"),t=!1,this.ns){var s=this;c.forEachChild(e,null,function(e){e.getAttribute("xmlns")==s.ns&&(t=!0)}),t=t||e.getAttribute("xmlns")==this.ns}else t=!0;return!t||this.name&&!c.isTagEqual(e,this.name)||this.type&&e.getAttribute("type")!=this.type||this.id&&e.getAttribute("id")!=this.id||this.from&&n!=this.from?!1:!0},run:function(e){var t=null;try{t=this.handler(e)}catch(n){throw n.sourceURL?c.fatal("error: "+this.handler+" "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message):n.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",n,n.message)),c.fatal("error: "+this.handler+" "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message)):c.fatal("error: "+n.message+"\n"+n.stack),n}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},c.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},c.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},c.Connection=function(e,t){this.service=e,this.options=t||{};var n=this.options.protocol||"";this._proto=0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?new c.Websocket(this):new c.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var s in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(s)){var r=c._connectionPlugins[s],i=function(){};i.prototype=r,this[s]=new i,this[s].init(this)}},c.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){return"string"==typeof e||"number"==typeof e?++this._uniqueId+":"+e:++this._uniqueId+""},connect:function(e,t,n,s,r,i){this.jid=e,this.authzid=c.getBareJidFromJid(this.jid),this.authcid=c.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.domain=c.getDomainFromJid(this.jid),this._changeConnectStatus(c.Status.CONNECTING,null),this._proto._connect(s,r,i)},attach:function(e,t,n,s,r,i,o){this._proto._attach(e,t,n,s,r,i,o)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else this._queueData("function"==typeof e.tree?e.tree():e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(e,t,n,s){var r=null,i=this;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o));var a=this.addHandler(function(e){r&&i.deleteTimedHandler(r);var s=e.getAttribute("type");if("result"==s)t&&t(e);else{if("error"!=s)throw{name:"StropheError",message:"Got bad IQ type of "+s};n&&n(e)}},null,"iq",null,o);return s&&(r=this.addTimedHandler(s,function(){return i.deleteHandler(a),n&&n(null),!1})),this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(e,t){var n=new c.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,s,r,i,o){var a=new c.Handler(e,t,n,s,r,i,o);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e)},disconnect:function(e){if(this._changeConnectStatus(c.Status.DISCONNECTING,e),c.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=u({xmlns:c.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}},_changeConnectStatus:function(e,t){for(var n in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(n)){var s=this[n];if(s.statusChanged)try{s.statusChanged(e,t)}catch(r){c.error(""+n+" plugin caused an exception changing status: "+r)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(i){c.error("User connection callback caused an exception: "+i)}},_doDisconnect:function(){null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),c.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(c.Status.DISCONNECTED,null),this.connected=!1},_dataRecv:function(e,t){c.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){this.xmlInput!==c.Connection.prototype.xmlInput&&this.xmlInput(n.nodeName===this._proto.strip&&n.childNodes.length?n.childNodes[0]:n),this.rawInput!==c.Connection.prototype.rawInput&&this.rawInput(t?t:c.serialize(n));for(var s,r;this.removeHandlers.length>0;)r=this.removeHandlers.pop(),s=this.handlers.indexOf(r),s>=0&&this.handlers.splice(s,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var i,o,a=n.getAttribute("type");if(null!==a&&"terminate"==a){if(this.disconnecting)return;return i=n.getAttribute("condition"),o=n.getElementsByTagName("conflict"),null!==i?("remote-stream-error"==i&&o.length>0&&(i="conflict"),this._changeConnectStatus(c.Status.CONNFAIL,i)):this._changeConnectStatus(c.Status.CONNFAIL,"unknown"),this.disconnect("unknown stream-error"),void 0}var u=this;c.forEachChild(n,null,function(e){var t,n;for(n=u.handlers,u.handlers=[],t=0;t<n.length;t++){var s=n[t];try{!s.isMatch(e)||!u.authenticated&&s.user?u.handlers.push(s):s.run(e)&&u.handlers.push(s)}catch(r){c.warn("Removing Strophe handlers due to uncaught exception: "+r.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){c.info("_connect_cb was called"),this.connected=!0;var s=this._proto._reqToData(e);if(s){this.xmlInput!==c.Connection.prototype.xmlInput&&this.xmlInput(s.nodeName===this._proto.strip&&s.childNodes.length?s.childNodes[0]:s),this.rawInput!==c.Connection.prototype.rawInput&&this.rawInput(n?n:c.serialize(s));var r=this._proto._connect_cb(s);if(r!==c.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var i=s.getElementsByTagName("stream:features").length>0;i||(i=s.getElementsByTagName("features").length>0);var o,a,u=s.getElementsByTagName("mechanism"),l=[],h=!1;if(!i)return void this._proto._no_auth_received(t);if(u.length>0)for(o=0;o<u.length;o++)a=c.getText(u[o]),this.mechanisms[a]&&l.push(this.mechanisms[a]);return this._authentication.legacy_auth=s.getElementsByTagName("auth").length>0,(h=this._authentication.legacy_auth||l.length>0)?void(this.do_authentication!==!1&&this.authenticate(l)):void this._proto._no_auth_received(t)}}},authenticate:function(e){var t;for(t=0;t<e.length-1;++t){for(var n=t,s=t+1;s<e.length;++s)e[s].prototype.priority>e[n].prototype.priority&&(n=s);if(n!=t){var i=e[t];e[t]=e[n],e[n]=i}}var o=!1;for(t=0;t<e.length;++t)if(e[t].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[t],this._sasl_mechanism.onStart(this);var u=r("auth",{xmlns:c.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var l=this._sasl_mechanism.onChallenge(this,null);u.t(d.encode(l))}this.send(u.tree()),o=!0;break}o||(null===c.getNodeFromJid(this.jid)?(this._changeConnectStatus(c.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(c.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(a({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(e){var t=d.decode(c.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),s=r("response",{xmlns:c.NS.SASL});return""!==n&&s.t(d.encode(n)),this.send(s.tree()),!0},_auth1_cb:function(){var e=a({type:"set",id:"_auth_2"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return c.getResourceFromJid(this.jid)||(this.jid=c.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(c.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t,n=d.decode(c.getText(e)),s=/([a-z]+)=([^,]+)(,|$)/,r=n.match(s);if("v"==r[1]&&(t=r[2]),t!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return c.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var s=c.getResourceFromJid(this.jid);return this.send(s?a({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).c("resource",{}).t(s).tree():a({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"==e.getAttribute("type")){c.info("SASL binding failed.");var t,n=e.getElementsByTagName("conflict");return n.length>0&&(t="conflict"),this._changeConnectStatus(c.Status.AUTHFAIL,t),!1}var s,r=e.getElementsByTagName("bind");return r.length>0?(s=r[0].getElementsByTagName("jid"),void(s.length>0&&(this.jid=c.getText(s[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(a({type:"set",id:"_session_auth_2"}).c("session",{xmlns:c.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null))))):(c.info("SASL binding failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return c.info("Session creation failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(c.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new c.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,s,r){var i=new c.Handler(e,t,n,s,r);return i.user=!1,this.addHandlers.push(i),i},_onDisconnectTimeout:function(){return c.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,s;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),e>=0&&this.timedHandlers.splice(e,1);var r=(new Date).getTime();for(s=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],(this.authenticated||!t.user)&&(n=t.lastCalled+t.period,0>=n-r?t.run()&&s.push(t):s.push(t));this.timedHandlers=s,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},s&&s(c,r,i,a,u),c.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},c.SASLMechanism.prototype={test:function(){return!0},onStart:function(e){this._connection=e},onChallenge:function(){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},c.SASLAnonymous=function(){},c.SASLAnonymous.prototype=new c.SASLMechanism("ANONYMOUS",!1,10),c.SASLAnonymous.test=function(e){return null===e.authcid},c.Connection.prototype.mechanisms[c.SASLAnonymous.prototype.name]=c.SASLAnonymous,c.SASLPlain=function(){},c.SASLPlain.prototype=new c.SASLMechanism("PLAIN",!0,20),c.SASLPlain.test=function(e){return null!==e.authcid},c.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\x00",t+=e.authcid,t+="\x00",t+=e.pass},c.Connection.prototype.mechanisms[c.SASLPlain.prototype.name]=c.SASLPlain,c.SASLSHA1=function(){},c.SASLSHA1.prototype=new c.SASLMechanism("SCRAM-SHA-1",!0,40),c.SASLSHA1.test=function(e){return null!==e.authcid},c.SASLSHA1.prototype.onChallenge=function(s,r,i){var a=i||p.hexdigest(1234567890*Math.random()),u="n="+s.authcid;return u+=",r=",u+=a,s._sasl_data.cnonce=a,s._sasl_data["client-first-message-bare"]=u,u="n,,"+u,this.onChallenge=function(s,r){for(var i,a,u,c,h,p,f,g,m,_,y,b="c=biws,",S=s._sasl_data["client-first-message-bare"]+","+r+",",v=s._sasl_data.cnonce,x=/([a-z]+)=([^,]+)(,|$)/;r.match(x);){var T=r.match(x);switch(r=r.replace(T[0],""),T[1]){case"r":i=T[2];break;case"s":a=T[2];break;case"i":u=T[2]}}if(i.substr(0,v.length)!==v)return s._sasl_data={},s._sasl_failure_cb();for(b+="r="+i,S+=b,a=d.decode(a),a+="\x00\x00\x00",c=p=o(s.pass,a),f=1;u>f;f++){for(h=o(s.pass,l(p)),g=0;5>g;g++)c[g]^=h[g];p=h}for(c=l(c),m=o(c,"Client Key"),_=n(c,"Server Key"),y=o(e(l(m)),S),s._sasl_data["server-signature"]=t(_,S),g=0;5>g;g++)m[g]^=y[g];return b+=",p="+d.encode(l(m))}.bind(this),u},c.Connection.prototype.mechanisms[c.SASLSHA1.prototype.name]=c.SASLSHA1,c.SASLMD5=function(){},c.SASLMD5.prototype=new c.SASLMechanism("DIGEST-MD5",!1,30),c.SASLMD5.test=function(e){return null!==e.authcid},c.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},c.SASLMD5.prototype.onChallenge=function(e,t,n){for(var s,r=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,i=n||p.hexdigest(""+1234567890*Math.random()),o="",a=null,u="",c="";t.match(r);)switch(s=t.match(r),t=t.replace(s[0],""),s[2]=s[2].replace(/^"(.+)"$/,"$1"),s[1]){case"realm":o=s[2];break;case"nonce":u=s[2];break;case"qop":c=s[2];break;case"host":a=s[2]}var l=e.servtype+"/"+e.domain;null!==a&&(l=l+"/"+a);var h=p.hash(e.authcid+":"+o+":"+this._connection.pass)+":"+u+":"+i,d="AUTHENTICATE:"+l,f="";return f+="charset=utf-8,",f+="username="+this._quote(e.authcid)+",",f+="realm="+this._quote(o)+",",f+="nonce="+this._quote(u)+",",f+="nc=00000001,",f+="cnonce="+this._quote(i)+",",f+="digest-uri="+this._quote(l)+",",f+="response="+p.hexdigest(p.hexdigest(h)+":"+u+":00000001:"+i+":auth:"+p.hexdigest(d))+",",f+="qop=auth",this.onChallenge=function(){return""}.bind(this),f},c.Connection.prototype.mechanisms[c.SASLMD5.prototype.name]=c.SASLMD5}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.Request=function(e,t,n,s){this.id=++Strophe._requestId,this.xmlData=e,this.data=Strophe.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=0/0,this.sends=s||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)));return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},Strophe.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var e=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold;var s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});n&&s.attrs({route:n});var r=this._conn._connect_cb;this._requests.push(new Strophe.Request(s.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,s,r,i,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=s,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=i||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_connect_cb:function(e){var t,n,s=e.getAttribute("type");if(null!==s&&"terminate"==s)return Strophe.error("BOSH-Connection failed: "+t),t=e.getAttribute("condition"),n=e.getElementsByTagName("conflict"),null!==t?("remote-stream-error"==t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(),Strophe.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var i=e.getAttribute("hold");i&&(this.hold=parseInt(i,10));var o=e.getAttribute("wait");o&&(this.wait=parseInt(o,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random())},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,Strophe.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),e.push(null)),this._requests.length<2&&e.length>0&&!this._conn.paused){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}if(this._requests.length>0){var s=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),s>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())
}},_onRequestStateChange:function(e,t){if(Strophe.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);var n;if(4==t.xhr.readyState){n=0;try{n=t.xhr.status}catch(s){}if("undefined"==typeof n&&(n=0),this.disconnecting&&n>=400)return void this._hitError(n);var r=this._requests[0]==t,i=this._requests[1]==t;(n>0&&500>n||t.sends>5)&&(this._removeRequest(t),Strophe.debug("request id "+t.id+" should now be removed")),200==n?((i||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),Strophe.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):(Strophe.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),(0===n||n>=400&&600>n||n>=12e3)&&(this._hitError(n),n>=400&&500>n&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect()))),n>0&&500>n||t.sends>5||this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],s=-1;try{4==n.xhr.readyState&&(s=n.xhr.status)}catch(r){Strophe.error("caught an error in _requests["+e+"], reqStatus: "+s)}if("undefined"==typeof s&&(s=-1),n.sends>this.maxRetries)return void this._onDisconnectTimeout();var i=n.age(),o=!isNaN(i)&&i>Math.floor(Strophe.TIMEOUT*this.wait),a=null!==n.dead&&n.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),u=4==n.xhr.readyState&&(1>s||s>=500);if((o||a||u)&&(a&&Strophe.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new Strophe.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){Strophe.debug("request id "+n.id+"."+n.sends+" posting");try{n.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0)}catch(c){return Strophe.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),this._conn.disconnect(),void 0}var l=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var s in e)e.hasOwnProperty(s)&&n.xhr.setRequestHeader(s,e[s])}n.xhr.setRequestHeader("Content-Type","text/plain"),n.xhr.send(n.data)};if(n.sends>1){var h=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(l,h)}else l();n.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&this._conn.xmlOutput(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?n.xmlData.childNodes[0]:n.xmlData),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else Strophe.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)},_removeRequest:function(e){Strophe.debug("removing request");var t;for(t=this._requests.length-1;t>=0;t--)e==this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){Strophe.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){Strophe.debug(this._requests?"_throttledRequestHandler called with "+this._requests.length+" requests":"_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},Strophe.Websocket=function(e){this._conn=e,this.strip="stream:stream";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";n+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==t.indexOf("/")?window.location.pathname+t:t,e.service=n}},Strophe.Websocket.prototype={_buildStream:function(){return $build("stream:stream",{to:this._conn.domain,xmlns:Strophe.NS.CLIENT,"xmlns:stream":Strophe.NS.STREAM,version:"1.0"})},_check_streamerror:function(e,t){var n=e.getElementsByTagName("stream:error");if(0===n.length)return!1;for(var s=n[0],r="",i="",o="urn:ietf:params:xml:ns:xmpp-streams",a=0;a<s.childNodes.length;a++){var u=s.childNodes[a];if(u.getAttribute("xmlns")!==o)break;"text"===u.nodeName?i=u.textContent:r=u.nodeName}var c="WebSocket stream error: ";return c+=r?r:"unknown",i&&(c+=" - "+r),Strophe.error(c),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var t=this._check_streamerror(e,Strophe.Status.CONNFAIL);return t?Strophe.Status.CONNFAIL:void 0},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in stream:stream":n!==Strophe.NS.CLIENT&&(t="Wrong xmlns in stream:stream: "+n);var s=e.namespaceURI;"string"!=typeof s?t="Missing xmlns:stream in stream:stream":s!==Strophe.NS.STREAM&&(t="Wrong xmlns:stream in stream:stream: "+s);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in stream:stream":"1.0"!==r&&(t="Wrong version in stream:stream: "+r),t?(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<stream:stream ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;t=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>");var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&(this._connect_cb(n),this.streamStart=e.data.replace(/^<stream:(.*)\/>$/,"<stream:$1>"))}else{if("</stream:stream>"===e.data)return this._conn.rawInput(e.data),this._conn.xmlInput(document.createElement("stream:stream")),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect(),void 0;var s=this._streamWrap(e.data),r=(new DOMParser).parseFromString(s,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(r,null,e.data)}},_disconnect:function(e){if(this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t="</stream:stream>";this._conn.xmlOutput(document.createElement("stream:stream")),this._conn.rawOutput(t);try{this.socket.send(t)}catch(n){Strophe.info("Couldn't send closing stream tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return this.streamStart+e+"</stream:stream>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(e){Strophe.error("Server did not send any auth methods"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_onError:function(e){Strophe.error("Websocket error "+e),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n,s;"restart"===e[t]?(n=this._buildStream(),s=this._removeClosingTag(n),n=n.tree()):(n=e[t],s=Strophe.serialize(n)),this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(e){var t,n;if("</stream:stream>"===e.data){var s="</stream:stream>";return this._conn.rawInput(s),this._conn.xmlInput(document.createElement("stream:stream")),this._conn.disconnecting||this._conn._doDisconnect(),void 0}if(0===e.data.search("<stream:stream ")){if(n=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>"),t=(new DOMParser).parseFromString(n,"text/xml").documentElement,!this._handleStreamStart(t))return}else n=this._streamWrap(e.data),t=(new DOMParser).parseFromString(n,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){Strophe.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=this._removeClosingTag(e);this._conn.rawOutput(t),this.socket.send(t)},_removeClosingTag:function(e){var t=Strophe.serialize(e);return t=t.replace(/<(stream:stream .*[^\/])\/>$/,"<$1>")},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}()},{}],13:[function(e,t,n){!function(e,s){"object"==typeof n?t.exports=n=s():"function"==typeof define&&define.amd?define([],s):e.CryptoJS=s()}(this,function(){var e=e||function(e,t){var n={},s=n.lib={},r=s.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=s.WordArray=r.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,s=this.sigBytes,r=e.sigBytes;if(this.clamp(),s%4)for(var i=0;r>i;i++){var o=255&n[i>>>2]>>>24-8*(i%4);t[s+i>>>2]|=o<<24-8*((s+i)%4)}else if(n.length>65535)for(var i=0;r>i;i+=4)t[s+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],s=0;t>s;s+=4)n.push(0|4294967296*e.random());return new i.init(n,t)}}),o=n.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],r=0;n>r;r++){var i=255&t[r>>>2]>>>24-8*(r%4);s.push((i>>>4).toString(16)),s.push((15&i).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;t>s;s+=2)n[s>>>3]|=parseInt(e.substr(s,2),16)<<24-4*(s%8);return new i.init(n,t/2)}},u=o.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],r=0;n>r;r++){var i=255&t[r>>>2]>>>24-8*(r%4);s.push(String.fromCharCode(i))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;t>s;s++)n[s>>>2]|=(255&e.charCodeAt(s))<<24-8*(s%4);return new i.init(n,t)}},c=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=s.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,s=n.words,r=n.sigBytes,o=this.blockSize,a=4*o,u=r/a;u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0);var c=u*o,l=e.min(4*c,r);if(c){for(var h=0;c>h;h+=o)this._doProcessBlock(s,h);var d=s.splice(0,c);n.sigBytes-=l}return new i.init(d,l)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);return e})},{}],14:[function(e,t,n){!function(s,r){"object"==typeof n?t.exports=n=r(e("./core"),e("./sha1"),e("./hmac")):"function"==typeof define&&define.amd?define(["./core","./sha1","./hmac"],r):r(s.CryptoJS)}(this,function(e){return e.HmacSHA1})},{"./core":13,"./hmac":15,"./sha1":16}],15:[function(e,t,n){!function(s,r){"object"==typeof n?t.exports=n=r(e("./core")):"function"==typeof define&&define.amd?define(["./core"],r):r(s.CryptoJS)}(this,function(e){!function(){var t=e,n=t.lib,s=n.Base,r=t.enc,i=r.Utf8,o=t.algo;o.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,s=4*n;t.sigBytes>s&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),o=this._iKey=t.clone(),a=r.words,u=o.words,c=0;n>c;c++)a[c]^=1549556828,u[c]^=909522486;r.sigBytes=o.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var s=t.finalize(this._oKey.clone().concat(n));return s}})}()})},{"./core":13}],16:[function(e,t,n){!function(s,r){"object"==typeof n?t.exports=n=r(e("./core")):"function"==typeof define&&define.amd?define(["./core"],r):r(s.CryptoJS)}(this,function(e){return function(){var t=e,n=t.lib,s=n.WordArray,r=n.Hasher,i=t.algo,o=[],a=i.SHA1=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,s=n[0],r=n[1],i=n[2],a=n[3],u=n[4],c=0;80>c;c++){if(16>c)o[c]=0|e[t+c];else{var l=o[c-3]^o[c-8]^o[c-14]^o[c-16];o[c]=l<<1|l>>>31}var h=(s<<5|s>>>27)+u+o[c];h+=20>c?(r&i|~r&a)+1518500249:40>c?(r^i^a)+1859775393:60>c?(r&i|r&a|i&a)-1894007588:(r^i^a)-899497514,u=a,a=i,i=r<<30|r>>>2,r=s,s=h}n[0]=0|n[0]+s,n[1]=0|n[1]+r,n[2]=0|n[2]+i,n[3]=0|n[3]+a,n[4]=0|n[4]+u},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,s=8*e.sigBytes;return t[s>>>5]|=128<<24-s%32,t[(s+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(s+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=r._createHelper(a),t.HmacSHA1=r._createHmacHelper(a)}(),e.SHA1})},{"./core":13}]},{},[11]);